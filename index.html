<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë£¨í‹´ì²´í¬</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#222222">

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
background:#f6f6f6;margin:0;padding:14px;color:#222}
h1{text-align:center;margin:6px 0}
.small{font-size:13px;color:#666}
.tabs{display:flex;gap:8px;margin:12px 0}
.tab{flex:1;padding:10px;border-radius:12px;border:none;background:#e6e6e6;font-size:14px}
.tab.active{background:#cfcfcf;font-weight:700}
.modes{display:flex;gap:8px;margin-bottom:10px}
.mode{flex:1;padding:10px;border-radius:12px;border:none;background:#e6e6e6;font-size:13px}
.mode.on{background:#cfcfcf;font-weight:700}
.section{background:#fff;border-radius:14px;padding:12px;margin-bottom:10px}
.section h2{margin:0 0 8px;font-size:16px}
label{display:flex;align-items:center;gap:8px;padding:6px 0}
input[type=checkbox]{width:18px;height:18px}
.result{text-align:center;font-size:20px;font-weight:800;margin:14px 0}
.pass{color:#2e7d32}.mid{color:#f9a825}.rest{color:#c62828}
.btn{width:100%;padding:10px;border-radius:12px;border:none;background:#e6e6e6;font-size:14px}
.btn:active{background:#cfcfcf}
.hide{display:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eee;font-size:13px}
th{color:#666;text-align:left}
.badge{padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700}
.ok{background:#e7f6ea;color:#2e7d32}
.midb{background:#fff4d6;color:#f9a825}
.restb{background:#fde7e7;color:#c62828}
input[type=number]{width:130px;padding:6px;border-radius:8px;border:1px solid #ccc}
</style>
</head>

<body>

<h1>ğŸˆë£¨í‹´ ì²´í¬</h1>

<div class="tabs">
  <button class="tab active" id="tabToday" onclick="showTab('today')">â™¥ï¸ì˜¤ëŠ˜</button>
  <button class="tab" id="tabWeek" onclick="showTab('week')">ğŸ““ì£¼ê°„ ìš”ì•½</button>
</div>

<div class="modes">
  <button class="mode" id="mHard" onclick="setMode('hard')">ğŸ˜ªí˜ë“  ë‚ </button>
  <button class="mode" id="mCycle" onclick="setMode('cycle')">ğŸ©¸ìƒë¦¬ì£¼ê¸°</button>
  <button class="mode" id="mTravel" onclick="setMode('travel')">âœˆï¸ì—¬í–‰/ì´íƒˆ</button>
</div>


<!-- TODAY -->
<div id="viewToday">

<div class="section">
  <div class="small">ğŸ¯ ëª©í‘œ: 1,450 ~ 1,650 kcal</div>
  <div style="margin-top:6px">
    ì˜¤ëŠ˜ ì„­ì·¨ kcal:
    <input type="number" id="kcalInput" placeholder="ì…ë ¥">
  </div>
  <div class="small" id="proteinText" style="margin-top:6px"></div>
</div>

<div id="checklist"></div>

<div class="result" id="result">ì²´í¬ ì‹œì‘</div>

<button class="btn" onclick="resetToday()">ì˜¤ëŠ˜ ì²´í¬ ì´ˆê¸°í™”</button>

</div>

<!-- WEEK -->
<div id="viewWeek" class="hide">
  <div class="section">
    <h2>ìµœê·¼ 7ì¼</h2>
    <div class="small" id="weekSummary"></div>
  </div>
  <div class="section">
    <table>
      <thead>
        <tr>
          <th>ë‚ ì§œ</th><th>ëª¨ë“œ</th><th>ì ìˆ˜</th><th>íŒì •</th><th>ë‹¨ë°±ì§ˆ</th>
        </tr>
      </thead>
      <tbody id="weekTable"></tbody>
    </table>
  </div>
</div>

<script>
const todayKey = new Date().toISOString().slice(0,10);
document.getElementById("today").innerText = todayKey;

const MIN_PROTEIN = 58;
const PROTEIN_UNIT = 15;

const BASE_ITEMS = [
  {c:"í•˜ë£¨",t:"ğŸ’§ ë¬¼ 2L ì´ìƒ",w:1},
  {c:"í•˜ë£¨",t:"â›” 14ì‹œê°„ ë‹¨ì‹",w:1},

  {c:"ì•„ì¹¨",t:"ğŸŒ 10ì‹œ ì „ ê¸°ìƒ",w:1},
  {c:"ì•„ì¹¨",t:"ğŸª¥ ì–‘ì¹˜ + í™˜ê¸° + ë¬¼",w:1},
  {c:"ì•„ì¹¨",t:"ğŸ’Š ì˜ì–‘ì œ",w:1},
  {c:"ì•„ì¹¨",t:"ğŸ‹ ë ˆëª¬ë¬¼ ì„¸íŠ¸",w:1},
  {c:"ì•„ì¹¨",t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},

  {c:"ì ì‹¬",t:"ğŸ¥© ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
  {c:"ì ì‹¬",t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„",w:2},
  {c:"ì ì‹¬",t:"ğŸ’Š ì˜ì–‘ì œ",w:1},

  {c:"ì˜¤í›„",t:"ğŸ§€ ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},

  {c:"ì €ë…",t:"ğŸ— ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
  {c:"ì €ë…",t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„",w:2},

  {c:"ìš´ë™",t:"ğŸª í´ ë˜ëŠ” 5ë¶„ ì „ì‹ ìš´ë™",w:2},
  {c:"ìš´ë™",t:"ğŸ”¥ ë³µë¶€(ë³´ë„ˆìŠ¤)",w:0},
  {c:"ìš´ë™",t:"ğŸ’ª ì–´ê¹¨(ë³´ë„ˆìŠ¤)",w:0},
  {c:"ìš´ë™",t:"ğŸª½ ë“±(ë³´ë„ˆìŠ¤)",w:0},
  {c:"ìš´ë™",t:"ğŸ‘ í™(ë³´ë„ˆìŠ¤)",w:0},
];

const MODES = {
  base: BASE_ITEMS,
  hard: [
    {c:"í•µì‹¬",t:"ğŸ¥¤ ë‹¨ë°±ì§ˆ 1íšŒ",w:2,p:1},
    {c:"í•µì‹¬",t:"ğŸ’§ ë¬¼ 1ì»µ",w:1},
    {c:"í•µì‹¬",t:"ğŸ§˜ 5ë¶„ ì „ì‹  ë˜ëŠ” ìŠ¤íŠ¸ë ˆì¹­",w:2},
  ],
cycle: [
  {c:"í•˜ë£¨", t:"ğŸ’§ ë¬¼ ì¶©ë¶„íˆ", w:1},
  {c:"í•˜ë£¨", t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨", w:2, p:1},
  {c:"í•˜ë£¨", t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨ (ì¶”ê°€)", w:2, p:1},
  {c:"í•˜ë£¨", t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„ ë˜ëŠ” ê°€ë²¼ìš´ ì›€ì§ì„", w:2},
  {c:"í•˜ë£¨", t:"ğŸ§˜ 5ë¶„ ì „ì‹  ë˜ëŠ” ìŠ¤íŠ¸ë ˆì¹­", w:2},
  {c:"í•˜ë£¨", t:"ğŸ“ ê¸°ë¡(ëŒ€ì¶©ì´ë¼ë„)", w:1},
],
  travel: [
    {c:"ì—¬í–‰",t:"ğŸ¥¤ ë‹¨ë°±ì§ˆ 1íšŒ",w:2,p:1},
    {c:"ì—¬í–‰",t:"ğŸš¶ ê±·ê¸° 10ë¶„",w:2},
    {c:"ì—¬í–‰",t:"ğŸ“ ê¸°ë¡ ê°€ëŠ¥í•˜ë©´",w:1},
  ]
};

let state = JSON.parse(localStorage.getItem(todayKey)) || {mode:"base",checks:{},kcal:""};

document.getElementById("kcalInput").value = state.kcal || "";

function save(){localStorage.setItem(todayKey,JSON.stringify(state));}

function setMode(m){
  state.mode = state.mode===m ? "base" : m;
  save();render();
}

function render(){
  ["mHard","mCycle","mTravel"].forEach(id=>document.getElementById(id).classList.remove("on"));
  if(state.mode==="hard")mHard.classList.add("on");
  if(state.mode==="cycle")mCycle.classList.add("on");
  if(state.mode==="travel")mTravel.classList.add("on");

  const items = MODES[state.mode];
  const wrap = document.getElementById("checklist");
  wrap.innerHTML="";
  let cur="";
  items.forEach((it,i)=>{
    if(it.c!==cur){
      cur=it.c;
      const s=document.createElement("div");
      s.className="section";
      s.innerHTML=`<h2>${cur}</h2>`;
      wrap.appendChild(s);
    }
    const id=state.mode+"_"+i;
    const lbl=document.createElement("label");
    lbl.innerHTML=`<input type="checkbox" ${state.checks[id]?"checked":""}> ${it.t}`;
    lbl.querySelector("input").onchange=e=>{
      state.checks[id]=e.target.checked;
      save();update();
    };
    wrap.lastChild.appendChild(lbl);
  });
  update();
}

function update(){
  const items = MODES[state.mode];
  let score=0,total=0,protein=0;
  items.forEach((it,i)=>{
    const id=state.mode+"_"+i;
    if(it.w>0){total+=it.w;if(state.checks[id])score+=it.w;}
    if(it.p && state.checks[id])protein+=PROTEIN_UNIT;
  });
  document.getElementById("proteinText").innerText =
    `ğŸ¥© ë‹¨ë°±ì§ˆ ${protein}g / ìµœì†Œ ${MIN_PROTEIN}g`;

  const r=document.getElementById("result");
  const ratio=score/total;
  if(ratio>=0.6){r.innerText="ì˜¤ëŠ˜ í•©ê²© âœ…";r.className="result pass";}
  else if(ratio>=0.3){r.innerText="ë³´í†µ ğŸ™‚";r.className="result mid";}
  else{r.innerText="íšŒë³µ ë°ì´ ğŸŒ±";r.className="result rest";}
}

function resetToday(){
  if(confirm("ì˜¤ëŠ˜ ì²´í¬ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")){
    state={mode:"base",checks:{},kcal:""};
    save();render();
  }
}

function showTab(t){
  tabToday.classList.toggle("active",t==="today");
  tabWeek.classList.toggle("active",t==="week");
  viewToday.classList.toggle("hide",t!=="today");
  viewWeek.classList.toggle("hide",t!=="week");
  if(t==="week")renderWeek();
}

function renderWeek(){
  const body=document.getElementById("weekTable");
  body.innerHTML="";
  let pass=0,mid=0,rest=0;
  for(let i=6;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const k=d.toISOString().slice(0,10);
    const s=JSON.parse(localStorage.getItem(k)||"{}");
    if(!s.checks)continue;
    let score=0,total=0,protein=0;
    (MODES[s.mode||"base"]||[]).forEach((it,j)=>{
      const id=(s.mode||"base")+"_"+j;
      if(it.w>0){total+=it.w;if(s.checks[id])score+=it.w;}
      if(it.p && s.checks[id])protein+=PROTEIN_UNIT;
    });
    const ratio=score/total;
    let badge="restb",txt="íšŒë³µ";rest++;
    if(ratio>=0.6){badge="ok";txt="í•©ê²©";pass++;rest--;}
    else if(ratio>=0.3){badge="midb";txt="ë³´í†µ";mid++;rest--;}
    body.innerHTML+=`
      <tr>
        <td>${k}</td>
        <td>${s.mode||"base"}</td>
        <td>${score}/${total}</td>
        <td><span class="badge ${badge}">${txt}</span></td>
        <td>${protein}g</td>
      </tr>`;
  }
  document.getElementById("weekSummary").innerText=
    `í•©ê²© ${pass}ì¼ Â· ë³´í†µ ${mid}ì¼ Â· íšŒë³µ ${rest}ì¼`;
}

document.getElementById("kcalInput").oninput=e=>{
  state.kcal=e.target.value;save();
};

render();
</script>

</body>
</html>
