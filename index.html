<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸˆë£¨í‹´ ì²´í¬</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#222222">

<style>
/* ===== ê¸°ë³¸ ===== */
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f6f6f6;margin:0;padding:14px;color:#222
}
h1{text-align:center;margin:6px 0}
.small{font-size:13px;color:#666}
.tabs,.modes{display:flex;gap:8px;margin:12px 0}
.tab,.mode{
  flex:1;padding:10px;border-radius:12px;border:none;
  background:#e6e6e6;font-size:14px;
  white-space:nowrap;
}
.tab.active,.mode.on{background:#cfcfcf;font-weight:700}
.section{
  background:#fff;border-radius:14px;padding:12px;margin-bottom:10px
}
.section h2{margin:0 0 8px;font-size:16px}
label{display:flex;align-items:center;gap:8px;padding:6px 0}
input[type=checkbox]{width:18px;height:18px}
.result{text-align:center;font-size:20px;font-weight:800;margin:14px 0}
.pass{color:#2e7d32}.mid{color:#f9a825}.rest{color:#c62828}
.btn{
  width:100%;padding:10px;border-radius:12px;border:none;
  background:#e6e6e6;font-size:14px
}
.btn:active{background:#cfcfcf}
.hide{display:none}

/* ===== í‘œ (ëª¨ë°”ì¼ ì¤„ë°”ê¿ˆ ì™„ì „ ë°©ì§€ í•µì‹¬) ===== */
table{
  width:max-content;
  min-width:100%;
  border-collapse:collapse;
  table-layout:auto;
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  font-size:13px;
  white-space:nowrap !important;
  word-break:keep-all !important;
  text-align:center;
  vertical-align:middle;
}
th{color:#666}

/* ì»¬ëŸ¼ ìµœì†Œ ë„ˆë¹„ */
th:nth-child(2),td:nth-child(2){min-width:70px;}   /* ëª¨ë“œ */
th:nth-child(4),td:nth-child(4){min-width:60px;}   /* íŒì • */
th:nth-child(5),td:nth-child(5){min-width:65px;}   /* ë‹¨ë°±ì§ˆ */

@media (max-width:420px){
  th,td{font-size:12px;padding:6px 8px}
}

/* ===== ë°°ì§€ ===== */
.badge{
  padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;
  white-space:nowrap;display:inline-block;
}
.ok{background:#e7f6ea;color:#2e7d32}
.midb{background:#fff4d6;color:#f9a825}
.restb{background:#fde7e7;color:#c62828}

/* BONUS ë°°ì§€ */
.bonusTag{
  margin-left:8px;font-size:12px;padding:2px 8px;
  border-radius:999px;background:#f1f1f1;color:#777;font-weight:700
}

/* ì „ì²´ ê¸°ë¡ ì›”ë³„ */
details{
  background:#fff;border-radius:14px;padding:10px 12px;margin-bottom:10px
}
details summary{cursor:pointer;font-weight:800;list-style:none}
details summary::-webkit-details-marker{display:none}
.summaryRow{display:flex;justify-content:space-between;align-items:center}
.mono{font-variant-numeric:tabular-nums}
</style>
</head>

<body>

<h1>ğŸˆë£¨í‹´ ì²´í¬</h1>
<div class="small" style="text-align:center" id="today"></div>

<!-- íƒ­ -->
<div class="tabs">
  <button class="tab active" id="tabToday" onclick="showTab('today')">â¤ï¸ì˜¤ëŠ˜</button>
  <button class="tab" id="tabWeek" onclick="showTab('week')">ğŸ““ì£¼ê°„ ìš”ì•½</button>
  <button class="tab" id="tabAll" onclick="showTab('all')">ğŸ“šì „ì²´ ê¸°ë¡</button>
</div>

<!-- ëª¨ë“œ -->
<div class="modes">
  <button class="mode" id="mHard" onclick="setMode('hard')">ğŸ˜ªí˜ë“  ë‚ </button>
  <button class="mode" id="mCycle" onclick="setMode('cycle')">ğŸ©¸ìƒë¦¬ì£¼ê¸°</button>
  <button class="mode" id="mTravel" onclick="setMode('travel')">âœˆï¸ì—¬í–‰/ì´íƒˆ</button>
</div>

<!-- ì˜¤ëŠ˜ -->
<div id="viewToday">
  <div class="section">
    <div class="small">ğŸ¯ ëª©í‘œ ì¹¼ë¡œë¦¬: 1,450 ~ 1,650 kcal</div>
    <div style="margin-top:6px">
      ì˜¤ëŠ˜ ì„­ì·¨ kcal:
      <input type="number" id="kcalInput" style="width:130px">
    </div>
    <div class="small" id="proteinText" style="margin-top:6px"></div>
  </div>

  <div id="checklist"></div>
  <div class="result" id="result">ì²´í¬ ì‹œì‘</div>
  <button class="btn" onclick="resetToday()">ì˜¤ëŠ˜ ì²´í¬ ì´ˆê¸°í™”</button>
</div>

<!-- ì£¼ê°„ -->
<div id="viewWeek" class="hide">
  <div class="section">
    <h2>ìµœê·¼ 7ì¼ ìš”ì•½</h2>
    <div class="small" id="weekSummary"></div>
  </div>
  <div class="section" style="overflow-x:auto">
    <table>
      <thead>
        <tr><th>ë‚ ì§œ</th><th>ëª¨ë“œ</th><th>ì ìˆ˜</th><th>íŒì •</th><th>ë‹¨ë°±ì§ˆ</th><th>kcal</th></tr>
      </thead>
      <tbody id="weekTable"></tbody>
    </table>
  </div>
</div>

<!-- ì „ì²´ -->
<div id="viewAll" class="hide">
  <div class="section">
    <h2>ì „ì²´ ê¸°ë¡</h2>
    <div class="small" id="allSummary"></div>
  </div>
  <div id="allGroups"></div>
</div>

<script>
/* ===== JS ë¡œì§ (ê¸°ëŠ¥ì€ ì´ì „ê³¼ ë™ì¼) ===== */
const todayKey=new Date().toISOString().slice(0,10);
today.innerText=todayKey;

const MIN_PROTEIN=58, PROTEIN_UNIT=15;

const BASE_ITEMS=[
{c:"í•˜ë£¨",t:"ğŸ’§ ë¬¼ 2L ì´ìƒ",w:1},
{c:"í•˜ë£¨",t:"â›” 14ì‹œê°„ ë‹¨ì‹",w:1},
{c:"ì•„ì¹¨",t:"ğŸŒ 10ì‹œ ì „ ê¸°ìƒ",w:1},
{c:"ì•„ì¹¨",t:"ğŸª¥ ì–‘ì¹˜ + í™˜ê¸° + ë¬¼",w:1},
{c:"ì•„ì¹¨",t:"ğŸ’Š ì˜ì–‘ì œ",w:1},
{c:"ì•„ì¹¨",t:"ğŸ‹ ë ˆëª¬ë¬¼ ì„¸íŠ¸",w:1},
{c:"ì•„ì¹¨",t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
{c:"ì ì‹¬",t:"ğŸ¥© ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
{c:"ì ì‹¬",t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„",w:2},
{c:"ì˜¤í›„",t:"ğŸ§€ ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
{c:"ì €ë…",t:"ğŸ— ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
{c:"ì €ë…",t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„",w:2},
{c:"ìš´ë™",t:"ğŸª í´ ë˜ëŠ” 5ë¶„ ì „ì‹ ìš´ë™",w:2},
{c:"ìš´ë™",t:"ğŸ”¥ ë³µë¶€",w:0},
{c:"ìš´ë™",t:"ğŸ’ª ì–´ê¹¨",w:0},
{c:"ìš´ë™",t:"ğŸª½ ë“±",w:0},
{c:"ìš´ë™",t:"ğŸ‘ í™",w:0},
];


const MODES = {
  base: BASE_ITEMS,
  hard: [
    {c:"í•µì‹¬",t:"ğŸ¥¤ ë‹¨ë°±ì§ˆ 1íšŒ",w:2,p:1},
    {c:"í•µì‹¬",t:"ğŸ’§ ë¬¼ 1ì»µ",w:1},
    {c:"í•µì‹¬",t:"ğŸ§˜ 5ë¶„ ì „ì‹  ë˜ëŠ” ìŠ¤íŠ¸ë ˆì¹­",w:2},
  ],
  cycle: [
    {c:"í•˜ë£¨",t:"ğŸ’§ ë¬¼ ì¶©ë¶„íˆ",w:1},
    {c:"í•˜ë£¨",t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨",w:2,p:1},
    {c:"í•˜ë£¨",t:"ğŸ¥š ë‹¨ë°±ì§ˆ ì„­ì·¨ (ì¶”ê°€)",w:2,p:1},
    {c:"í•˜ë£¨",t:"ğŸš¶ ì‹í›„ ê±·ê¸° 10ë¶„ ë˜ëŠ” ê°€ë²¼ìš´ ì›€ì§ì„",w:2},
    {c:"í•˜ë£¨",t:"ğŸ§˜ 5ë¶„ ì „ì‹  ë˜ëŠ” ìŠ¤íŠ¸ë ˆì¹­",w:2},
    {c:"í•˜ë£¨",t:"ğŸ“ ê¸°ë¡(ëŒ€ì¶©ì´ë¼ë„)",w:1},
  ],
  travel: [
    {c:"ì—¬í–‰",t:"ğŸ¥¤ ë‹¨ë°±ì§ˆ 1íšŒ",w:2,p:1},
    {c:"ì—¬í–‰",t:"ğŸš¶ ê±·ê¸° 10ë¶„",w:2},
    {c:"ì—¬í–‰",t:"ğŸ“ ê¸°ë¡ ê°€ëŠ¥í•˜ë©´",w:1},
  ]
};

const modeLabel=m=>m==="hard"?"ğŸ˜ªí˜ë“  ë‚ ":m==="cycle"?"ğŸ©¸ìƒë¦¬ì£¼ê¸°":m==="travel"?"âœˆï¸ì—¬í–‰/ì´íƒˆ":"ê¸°ë³¸";

let state=JSON.parse(localStorage.getItem(todayKey))||{mode:"base",checks:{},kcal:""};
kcalInput.value=state.kcal||"";

function save(){localStorage.setItem(todayKey,JSON.stringify(state));}

function setMode(m){state.mode=state.mode===m?"base":m;save();render();}

function render(){
["mHard","mCycle","mTravel"].forEach(id=>document.getElementById(id).classList.remove("on"));
if(state.mode==="hard")mHard.classList.add("on");
if(state.mode==="cycle")mCycle.classList.add("on");
if(state.mode==="travel")mTravel.classList.add("on");

checklist.innerHTML="";
let cur="";
MODES[state.mode].forEach((it,i)=>{
 if(it.c!==cur){cur=it.c;checklist.innerHTML+=`<div class="section"><h2>${cur}</h2></div>`;}
 const id=state.mode+"_"+i;
 const bonus=it.w===0?`<span class="bonusTag">BONUS</span>`:"";
 checklist.lastChild.innerHTML+=
 `<label><input type="checkbox" ${state.checks[id]?"checked":""}
 onchange="state.checks['${id}']=this.checked;save();update()"> ${it.t}${bonus}</label>`;
});
update();
}

function calc(s){
let sc=0,tot=0,p=0;
MODES[s.mode||"base"].forEach((it,i)=>{
 const id=(s.mode||"base")+"_"+i;
 if(it.w>0){tot+=it.w;if(s.checks?.[id])sc+=it.w;}
 if(it.p&&s.checks?.[id])p+=PROTEIN_UNIT;
});
return{sc,tot,p};
}

function update(){
const r=calc(state);
proteinText.innerText=`ğŸ¥© ë‹¨ë°±ì§ˆ ${r.p}g / ìµœì†Œ ${MIN_PROTEIN}g`;
result.innerText=r.sc/r.tot>=0.6?"ì˜¤ëŠ˜ í•©ê²© âœ…":r.sc/r.tot>=0.3?"ë³´í†µ ğŸ™‚":"íšŒë³µ ë°ì´ ğŸŒ±";
}

function resetToday(){if(confirm("ì´ˆê¸°í™”í• ê¹Œìš”?")){state={mode:"base",checks:{},kcal:""};save();render();}}

function showTab(t){
viewToday.classList.toggle("hide",t!=="today");
viewWeek.classList.toggle("hide",t!=="week");
viewAll.classList.toggle("hide",t!=="all");
tabToday.classList.toggle("active",t==="today");
tabWeek.classList.toggle("active",t==="week");
tabAll.classList.toggle("active",t==="all");
if(t==="week")renderWeek();
if(t==="all")renderAll();
}

function renderWeek(){
weekTable.innerHTML="";
let p=0,m=0,r=0;
for(let i=6;i>=0;i--){
 const d=new Date();d.setDate(d.getDate()-i);
 const k=d.toISOString().slice(0,10);
 const s=JSON.parse(localStorage.getItem(k)||"null");if(!s)continue;
 const c=calc(s);const ratio=c.sc/c.tot;
 const v=ratio>=0.6?["ok","í•©ê²©"]:(ratio>=0.3?["midb","ë³´í†µ"]:["restb","íšŒë³µ"]);
 if(v[1]==="í•©ê²©")p++;else if(v[1]==="ë³´í†µ")m++;else r++;
 weekTable.innerHTML+=`<tr><td>${k}</td><td>${modeLabel(s.mode)}</td>
 <td>${c.sc}/${c.tot}</td><td><span class="badge ${v[0]}">${v[1]}</span></td>
 <td>${c.p}g</td><td>${s.kcal||""}</td></tr>`;
}
weekSummary.innerText=`í•©ê²© ${p}ì¼ Â· ë³´í†µ ${m}ì¼ Â· íšŒë³µ ${r}ì¼`;
}

function renderAll(){
allGroups.innerHTML="";
const keys=Object.keys(localStorage).filter(k=>/^\d{4}-\d{2}-\d{2}$/.test(k)).sort().reverse();
const groups={};
keys.forEach(k=>{
 const s=JSON.parse(localStorage.getItem(k));if(!s)return;
 const ym=k.slice(0,7);groups[ym]=groups[ym]||[];groups[ym].push({k,s});
});
Object.entries(groups).forEach(([ym,arr],i)=>{
 let rows="";
 arr.forEach(({k,s})=>{
  const c=calc(s);const ratio=c.sc/c.tot;
  const v=ratio>=0.6?["ok","í•©ê²©"]:(ratio>=0.3?["midb","ë³´í†µ"]:["restb","íšŒë³µ"]);
  rows+=`<tr><td>${k}</td><td>${modeLabel(s.mode)}</td>
  <td>${c.sc}/${c.tot}</td><td><span class="badge ${v[0]}">${v[1]}</span></td>
  <td>${c.p}g</td><td>${s.kcal||""}</td></tr>`;
 });
 allGroups.innerHTML+=`
 <details ${i===0?"open":""}>
 <summary><div class="summaryRow">${ym}</div></summary>
 <div style="overflow-x:auto"><table>
 <thead><tr><th>ë‚ ì§œ</th><th>ëª¨ë“œ</th><th>ì ìˆ˜</th><th>íŒì •</th><th>ë‹¨ë°±ì§ˆ</th><th>kcal</th></tr></thead>
 <tbody>${rows}</tbody></table></div></details>`;
});
}

kcalInput.oninput=e=>{state.kcal=e.target.value;save();};
render();
</script>

</body>
</html>